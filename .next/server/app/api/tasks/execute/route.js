"use strict";(()=>{var e={};e.id=691,e.ids=[691],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},4577:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},796:(e,t,s)=>{s.r(t),s.d(t,{headerHooks:()=>p,originalPathname:()=>m,requestAsyncStorage:()=>c,routeModule:()=>i,serverHooks:()=>d,staticGenerationAsyncStorage:()=>l,staticGenerationBailout:()=>k});var r={};s.r(r),s.d(r,{POST:()=>POST});var o=s(884),a=s(6132),n=s(5798),u=s(2429);async function POST(e){try{let t=await e.json();console.log("Request body:",t);let{matterId:s,taskId:r}=t;if(!s||!r)return n.Z.json({success:!1,error:`matterId and taskId are required. Received: matterId=${s}, taskId=${r}`},{status:400});console.log(`Executing task: ${r} for matter: ${s}`);let o=await (0,u.UE)(),a=o.getMatter(s);if(!a)return console.log(`Matter ${s} not found in manager`),n.Z.json({success:!1,error:`Matter ${s} not found`},{status:404});let i=a.getTask(r);if(!i)return console.log(`Task ${r} not found in matter ${s}`),console.log("Available tasks:",Object.keys(a.tasks)),n.Z.json({success:!1,error:`Task ${r} not found. Available tasks: ${Object.keys(a.tasks).join(", ")}`},{status:404});if(console.log(`Found task: ${i.name}, completed: ${i.completed}`),i.completed)return n.Z.json({success:!0,result:`Task "${i.name}" already completed`,executed:!1});let c=i.checkDependenciesMet(a.tasks);if(!c){let e=[];for(let t of i.dependencies){let s=a.tasks[t.targetTaskId];if(!s){e.push(`Task "${t.targetTaskId}" not found`);continue}if("task_completion"===t.dependencyType)s.completed||e.push(`"${s.name}" not completed`);else if("time_based"===t.dependencyType){if(s.completed){if(s.completionDate){let r=new Date(s.completionDate);if(r.setDate(r.getDate()+7*(t.timeDelayWeeks||0)),new Date<r){let r=1===t.timeDelayWeeks?"week":"weeks";e.push(`${t.timeDelayWeeks} ${r} waiting period after "${s.name}" not complete`)}}}else e.push(`"${s.name}" not completed`)}}let t=e.join(", ");return n.Z.json({success:!0,result:`Task "${i.name}" not ready (${t})`,executed:!1,unmetDependencies:e})}let l=o.triggerTask(s,r);return console.log(`Task execution result: ${l}`),await (0,u.En)(o),n.Z.json({success:!0,result:`Task "${i.name}" complete`,executed:!0})}catch(e){return console.error("Error in task execution:",e),n.Z.json({success:!1,error:`Error: ${e instanceof Error?e.message:"Unknown error"}`},{status:500})}}let i=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/tasks/execute/route",pathname:"/api/tasks/execute",filename:"route",bundlePath:"app/api/tasks/execute/route"},resolvedPagePath:"/Users/rahulmohankumar/Downloads/finch/app/api/tasks/execute/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:c,staticGenerationAsyncStorage:l,serverHooks:d,headerHooks:p,staticGenerationBailout:k}=i,m="/api/tasks/execute/route"}};var t=require("../../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[585,429],()=>__webpack_exec__(796));module.exports=s})();